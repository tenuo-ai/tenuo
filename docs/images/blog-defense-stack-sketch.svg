<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 650 1020">
  <defs>
    <filter id="rough" x="-5%" y="-5%" width="110%" height="110%">
      <feTurbulence type="fractalNoise" baseFrequency="0.04" numOctaves="5" result="noise"/>
      <feDisplacementMap in="SourceGraphic" in2="noise" scale="2" xChannelSelector="R" yChannelSelector="G"/>
    </filter>
  </defs>
  
  <!-- Background -->
  <rect width="650" height="1020" fill="#fefefe"/>
  
  <!-- Title -->
  <text x="325" y="45" text-anchor="middle" fill="#1e1e1e" font-family="Comic Sans MS, cursive" font-size="28" font-weight="bold">The Defense Stack</text>
  
  <!-- LLM Output box -->
  <rect x="215" y="65" width="220" height="40" rx="3" fill="none" stroke="#374151" stroke-width="2" filter="url(#rough)"/>
  <text x="325" y="92" text-anchor="middle" fill="#374151" font-family="Comic Sans MS, cursive" font-size="15">LLM Output</text>
  
  <!-- Arrow 1 -->
  <path d="M325 107 Q327 115 323 125 Q325 130 325 138" stroke="#374151" stroke-width="2" fill="none" filter="url(#rough)"/>
  <path d="M317 130 L325 143 L333 130" stroke="#374151" stroke-width="2" fill="none" filter="url(#rough)"/>
  
  <!-- Layer 0 - Yellow/amber -->
  <rect x="50" y="150" width="550" height="105" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="2.5" filter="url(#rough)"/>
  <text x="325" y="178" text-anchor="middle" fill="#92400e" font-family="Comic Sans MS, cursive" font-size="17" font-weight="bold">LAYER 0: PROBABILISTIC FILTERS</text>
  <text x="325" y="200" text-anchor="middle" fill="#78350f" font-family="Comic Sans MS, cursive" font-size="12">Prompt injection classifiers, content filters</text>
  <text x="325" y="225" text-anchor="middle" fill="#065f46" font-family="Comic Sans MS, cursive" font-size="11">✓ Use for: Detection, alerting, friction</text>
  <text x="325" y="245" text-anchor="middle" fill="#991b1b" font-family="Comic Sans MS, cursive" font-size="11">✗ Don't use for: Enforcement</text>
  
  <!-- Arrow 2 -->
  <path d="M325 257 Q323 265 327 275 Q325 280 325 288" stroke="#374151" stroke-width="2" fill="none" filter="url(#rough)"/>
  <path d="M317 280 L325 293 L333 280" stroke="#374151" stroke-width="2" fill="none" filter="url(#rough)"/>
  
  <!-- Layer 1 - FADED/DEPRECATED - Gray -->
  <rect x="100" y="300" width="450" height="70" rx="6" fill="#f3f4f6" stroke="#d1d5db" stroke-width="1.5" stroke-dasharray="8,4" filter="url(#rough)" opacity="0.7"/>
  <text x="325" y="325" text-anchor="middle" fill="#9ca3af" font-family="Comic Sans MS, cursive" font-size="14" text-decoration="line-through">LAYER 1: PATTERN MATCHING (Regex)</text>
  <text x="325" y="348" text-anchor="middle" fill="#9ca3af" font-family="Comic Sans MS, cursive" font-size="11">if ".." in path: whack-a-mole with encodings</text>
  <text x="325" y="365" text-anchor="middle" fill="#dc2626" font-family="Comic Sans MS, cursive" font-size="10" font-weight="bold">⬆️ SUPERSEDED BY LAYER 1.5</text>
  
  <!-- Arrow 3 (skip Layer 1) -->
  <path d="M325 372 Q327 385 323 398 Q325 405 325 415" stroke="#374151" stroke-width="2" fill="none" filter="url(#rough)"/>
  <path d="M317 407 L325 420 L333 407" stroke="#374151" stroke-width="2" fill="none" filter="url(#rough)"/>
  
  <!-- Layer 1.5 - Blue -->
  <rect x="50" y="430" width="550" height="195" rx="8" fill="#dbeafe" stroke="#3b82f6" stroke-width="2.5" filter="url(#rough)"/>
  <text x="325" y="458" text-anchor="middle" fill="#1e40af" font-family="Comic Sans MS, cursive" font-size="17" font-weight="bold">LAYER 1.5: SEMANTIC VALIDATION</text>
  <text x="325" y="478" text-anchor="middle" fill="#1e3a8a" font-family="Comic Sans MS, cursive" font-size="11">(Annotating the Map)</text>
  
  <!-- Constraint boxes -->
  <rect x="90" y="495" width="120" height="42" rx="4" fill="#bfdbfe" stroke="#2563eb" stroke-width="2" filter="url(#rough)"/>
  <text x="150" y="513" text-anchor="middle" fill="#1d4ed8" font-family="Comic Sans MS, cursive" font-size="12" font-weight="bold">Subpath</text>
  <text x="150" y="528" text-anchor="middle" fill="#3b82f6" font-family="Comic Sans MS, cursive" font-size="9">normalize paths</text>
  
  <rect x="265" y="495" width="120" height="42" rx="4" fill="#bfdbfe" stroke="#2563eb" stroke-width="2" filter="url(#rough)"/>
  <text x="325" y="513" text-anchor="middle" fill="#1d4ed8" font-family="Comic Sans MS, cursive" font-size="12" font-weight="bold">UrlSafe</text>
  <text x="325" y="528" text-anchor="middle" fill="#3b82f6" font-family="Comic Sans MS, cursive" font-size="9">parse, check IPs</text>
  
  <rect x="440" y="495" width="120" height="42" rx="4" fill="#bfdbfe" stroke="#2563eb" stroke-width="2" filter="url(#rough)"/>
  <text x="500" y="513" text-anchor="middle" fill="#1d4ed8" font-family="Comic Sans MS, cursive" font-size="12" font-weight="bold">Shlex</text>
  <text x="500" y="528" text-anchor="middle" fill="#3b82f6" font-family="Comic Sans MS, cursive" font-size="9">parse, check ops</text>
  
  <!-- Catches/Misses -->
  <text x="325" y="560" text-anchor="middle" fill="#065f46" font-family="Comic Sans MS, cursive" font-size="10">✓ Catches: Encoding bypasses, parser tricks, semantic attacks</text>
  <text x="325" y="578" text-anchor="middle" fill="#991b1b" font-family="Comic Sans MS, cursive" font-size="10">✗ Misses: Runtime state (symlinks, DNS rebinding)</text>
  
  <!-- Context -->
  <text x="325" y="610" text-anchor="middle" fill="#1e40af" font-family="Comic Sans MS, cursive" font-size="10">Context: Stateless. Still the Map, but annotated.</text>
  
  <!-- Arrow 4 -->
  <path d="M325 627 Q327 640 323 655 Q325 662 325 672" stroke="#374151" stroke-width="2" fill="none" filter="url(#rough)"/>
  <path d="M317 664 L325 677 L333 664" stroke="#374151" stroke-width="2" fill="none" filter="url(#rough)"/>
  
  <!-- Layer 2 - Green -->
  <rect x="50" y="685" width="550" height="175" rx="8" fill="#d1fae5" stroke="#10b981" stroke-width="2.5" filter="url(#rough)"/>
  <text x="325" y="713" text-anchor="middle" fill="#065f46" font-family="Comic Sans MS, cursive" font-size="17" font-weight="bold">LAYER 2: EXECUTION GUARDS</text>
  <text x="325" y="733" text-anchor="middle" fill="#047857" font-family="Comic Sans MS, cursive" font-size="11">(Walking the Territory)</text>
  
  <!-- Guard boxes -->
  <rect x="90" y="750" width="120" height="42" rx="4" fill="#a7f3d0" stroke="#059669" stroke-width="2" filter="url(#rough)"/>
  <text x="150" y="768" text-anchor="middle" fill="#047857" font-family="Comic Sans MS, cursive" font-size="11" font-weight="bold">path_jail</text>
  <text x="150" y="783" text-anchor="middle" fill="#059669" font-family="Comic Sans MS, cursive" font-size="9">realpath, symlinks</text>
  
  <rect x="265" y="750" width="120" height="42" rx="4" fill="#a7f3d0" stroke="#059669" stroke-width="2" filter="url(#rough)"/>
  <text x="325" y="768" text-anchor="middle" fill="#047857" font-family="Comic Sans MS, cursive" font-size="11" font-weight="bold">url_jail</text>
  <text x="325" y="783" text-anchor="middle" fill="#059669" font-family="Comic Sans MS, cursive" font-size="9">DNS resolve, IP check</text>
  
  <rect x="440" y="750" width="120" height="42" rx="4" fill="#a7f3d0" stroke="#059669" stroke-width="2" filter="url(#rough)"/>
  <text x="500" y="768" text-anchor="middle" fill="#047857" font-family="Comic Sans MS, cursive" font-size="11" font-weight="bold">proc_jail</text>
  <text x="500" y="783" text-anchor="middle" fill="#059669" font-family="Comic Sans MS, cursive" font-size="9">execve control</text>
  
  <!-- Catches info -->
  <text x="325" y="815" text-anchor="middle" fill="#065f46" font-family="Comic Sans MS, cursive" font-size="10">✓ Catches: TOCTOU, symlinks, DNS rebinding, runtime state</text>
  <text x="325" y="835" text-anchor="middle" fill="#047857" font-family="Comic Sans MS, cursive" font-size="10">Context: Stateful. Touches disk, network, kernel.</text>
  
  <!-- Arrow 5 -->
  <path d="M325 862 Q323 875 327 888 Q325 895 325 905" stroke="#374151" stroke-width="2" fill="none" filter="url(#rough)"/>
  <path d="M317 897 L325 910 L333 897" stroke="#374151" stroke-width="2" fill="none" filter="url(#rough)"/>
  
  <!-- Execution -->
  <rect x="200" y="915" width="250" height="28" rx="5" fill="#bbf7d0" stroke="#22c55e" stroke-width="2" filter="url(#rough)"/>
  <text x="325" y="935" text-anchor="middle" fill="#15803d" font-family="Comic Sans MS, cursive" font-size="13">✓ SAFE EXECUTION</text>
</svg>
